version: '3'

services:
  rabbitmq:
    image: rabbitmq:management
    ports:
      - 15672:15672
      - 5672:5672

  case-server:
    image: powsybl/case-server:latest
    ports:
      - 5000:80
    volumes:
      - $PWD/../k8s/base/config/case-server-application.yml:/config/application.yml:Z
      - $HOME/cases:/cases:Z

  network-store-server:
    image: powsybl/network-store-server:latest
    ports:
      - 8080:80
    volumes:
      - $PWD/../k8s/base/config/network-store-server-application.yml:/config/application.yml:Z
      - $PWD/cassandra.properties:/config/cassandra.properties:Z

  geo-data-server:
    image: powsybl/geo-data-server:latest
    ports:
      - 8087:80
    volumes:
      - $PWD/../k8s/base/config/geo-data-server-application.yml:/config/application.yml:Z
      - $PWD/cassandra.properties:/config/cassandra.properties:Z

  single-line-diagram-server:
    image: powsybl/single-line-diagram-server:latest
    ports:
      - 5005:80
    volumes:
      - $PWD/../k8s/base/config/single-line-diagram-server-application.yml:/config/application.yml:Z

  network-modification-server:
    image: gridsuite/network-modification-server:latest
    ports:
      - 5007:80
    volumes:
      - $PWD/../k8s/base/config/network-modification-server-application.yml:/config/application.yml:Z

  loadflow-server:
    image: gridsuite/loadflow-server:latest
    ports:
      - 5008:80
    volumes:
      - $PWD/../k8s/base/config/loadflow-server-application.yml:/config/application.yml:Z

  notification-server:
    image: gridsuite/notification-server:latest
    ports:
      - 5009:80
    volumes:
      - $PWD/../k8s/base/config/notification-server-application.yml:/config/application.yml:Z

  balances-adjustment-server:
    image: gridsuite/balances-adjustment-server:latest
    ports:
      - 5010:80
    volumes:
      - $PWD/../k8s/base/config/balances-adjustment-server-application.yml:/config/application.yml:Z

  network-conversion-server:
    image: powsybl/network-conversion-server:latest
    ports:
      - 5003:80
    volumes:
      - $PWD/../k8s/base/config/network-conversion-server-application.yml:/config/application.yml:Z

  network-map-server:
    image: powsybl/network-map-server:latest
    ports:
      - 5006:80
    volumes:
      - $PWD/../k8s/base/config/network-map-server-application.yml:/config/application.yml:Z

  study-server:
    image: powsybl/study-server:latest
    ports:
      - 5001:80
    volumes:
      - $PWD/../k8s/base/config/study-server-application.yml:/config/application.yml:Z
      - $PWD/cassandra.properties:/config/cassandra.properties:Z

  cgmes-gl-server:
    image: powsybl/cgmes-gl-server:latest
    ports:
      - 8095:80
    volumes:
      - $PWD/../k8s/base/config/cgmes-gl-server-application.yml:/config/application.yml:Z

  odre-server:
    image: gridsuite/odre-server:latest
    ports:
      - 8090:80
    volumes:
      - $PWD/../k8s/base/config/odre-server-application.yml:/config/application.yml:Z

  gateway:
    image: gridsuite/gateway:latest
    ports:
      - 9000:80
    volumes:
      - $PWD/../k8s/base/config/gateway-application.yml:/config/application.yml:Z
      - $PWD/allowed-issuers.yml:/config/allowed-issuers.yml:Z

  study-app:
    image: powsybl/study-app:latest
    ports:
      - 80:80
    volumes:
      - $PWD/idpSettings.json:/usr/local/apache2/htdocs/study-app/idpSettings.json:Z

  mock_user_service:
    image: gridsuite/oidc-mock-server
    ports:
      - 9090:9090
    environment:
      - PORT=9090
      - CLIENT_ID=my-client
      - CLIENT_REDIRECT_URI=http://localhost/sign-in-callback
      - CLIENT_LOGOUT_REDIRECT_URI=http://localhost/logout-callback
      - CLIENT_SILENT_REDIRECT_URI=http://localhost/silent-renew-callback
      - ISSUER_HOST=172.17.0.1:9090
