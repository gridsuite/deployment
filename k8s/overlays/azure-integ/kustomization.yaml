apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

bases:
  - ../azure-commons

configMapGenerator:
  - name: gridstudy-app-configmap
    files:
      - idpSettings.json=gridstudy-app-idpSettings.json
  - name: gridstudy-app-env-configmap
    files:
      - env.json=env.json
  - name: gridmerge-app-configmap
    files:
      - idpSettings.json=gridmerge-app-idpSettings.json
  - name: gridmerge-app-env-configmap
    files:
      - env.json=env.json
  - name: gridactions-app-configmap
    files:
      - idpSettings.json=gridactions-app-idpSettings.json
  - name: gridactions-app-env-configmap
    files:
      - env.json=env.json

# generated by removing this and then running
# kubectl kustomize k8s/overlays/azure-integ/ | python3.7 .github/scripts/image-tag-to-digest.py
# and then grepping the images and doing some text editor macros
images:
  - name: docker.io/gridsuite/actions-server
    digest: cc1e9e772cfcd6a9120206c8739faff7683e165ecb8cb73641f5af7b6059ddb9
  - name: docker.io/gridsuite/balances-adjustment-server
    digest: 10f64d7637edb0feaabc422a9c04652e40c7325427627345173c27131654366c
  - name: docker.io/powsybl/case-server
    digest: d54ae3e1a8772c0e3229d9297464bbe5f8b3e5578aed0a5312165297877d6d93
  - name: docker.io/gridsuite/case-validation-server
    digest: e07c9cd30535a4945d4d643e3756b4e82ded79deb82e594aebfcc77340427528
  - name: docker.io/gridsuite/cgmes-boundary-server
    digest: e5a57fef66210d68cafcf10af83d95d959000adf0608fac7de091e5cf2021080
  - name: docker.io/powsybl/cgmes-gl-server
    digest: d23a6b0f18568a7cfe35280954bc40dfb68f521413024339c4c2c9aa002a22be
  - name: docker.io/gridsuite/config-notification-server
    digest: f6a235d0f1b3c6b02aaa1b0523b01ff74dce98791a51b62ae79df61a9ee38201
  - name: docker.io/gridsuite/config-server
    digest: 8f6e450f97f334fe058ea04162625c0e00fc56528dc0ba747ea63c53324a7bde
  - name: docker.io/gridsuite/dynamic-simulation-server
    digest: a3725c2bfde5d8828aad59e97b6b9c05142700c003da08781a3a044a6bae7096
  - name: docker.io/gridsuite/gateway
    digest: 7a9d09c6a5125d6303b305cb6002194cc6821e6fca07fe30433b53e2519b0ad6
  - name: docker.io/gridsuite/geo-data-server
    digest: 11f50e0a726f878f45036cf5b8e574594de62e0b29feebdecf91f914ba7607e1
  - name: docker.io/gridsuite/gridactions-app
    digest: 80a50902d4ed04c4905993d55773aa91ac1c8382b1934d93a203db637a4133bf
  - name: docker.io/gridsuite/gridmerge-app
    digest: 82b496a1e1f53506034d08fbc2589279db0db37088cb682cb78ac732ae170bf8
  - name: docker.io/gridsuite/gridstudy-app
    digest: 7a00004663879eaf12d032d605e587ccaf1ad1bc5ff9bff42af3a8433bdceb32
  - name: docker.io/gridsuite/loadflow-server
    digest: 215ea7d84c5d499f08b7f5972a908adc1d8e3b4fcb48a5b92c7bc12cd04e5e2d
  - name: docker.io/gridsuite/merge-notification-server
    digest: 86833ac3b4a5ba74555b67d073c4eb7d811e8f783958fa4f90fa9227d782c76a
  - name: docker.io/gridsuite/merge-orchestrator-server
    digest: 063357d6d7921e0a02e881d0d4331b044778fc016f4f225babf0cb4f83548cfa
  - name: docker.io/powsybl/network-conversion-server
    digest: a4c0a18a8aca763b24f9dd9383de59eccef9d1fe491021b5300e86a8c40a1bf3
  - name: docker.io/gridsuite/network-map-server
    digest: 938163ffdcb03bef0c38dd2b33eb62f0cfabebee4dcfb2c36f70c4dd12443ecb
  - name: docker.io/gridsuite/network-modification-server
    digest: 91fbc8f3ddb4fed871417bd9c92be3b61657f67bd57c98683bea7092e42fd997
  - name: docker.io/powsybl/network-store-server
    digest: 2de7d274626006d8db3ba35d09ea60f1dcd02c9f9a418d55183a10cf3ca5b0b1
  - name: docker.io/gridsuite/notification-server
    digest: 298756775ec0be4288cc561a16df062f0b404337cf5f2efa5027702a5d4cc3c8
  - name: docker.io/gridsuite/odre-server
    digest: 140c791e500be434c68a55796bfa888142c9dc3709d01144fb568bb0643900bf
  - name: docker.io/gridsuite/security-analysis-server
    digest: 70da84d7a73b415f9bb88410e9acffdfb7845f5448e5a7c8bd9645b36ee80156
  - name: docker.io/powsybl/single-line-diagram-server
    digest: 1e516b408a7156aed3b70b3fa7d6860ed80445b858b4630364ea6c892e3d01da
  - name: docker.io/gridsuite/study-server
    digest: 8f4f7382e3ac9e07e562c4e3e8180841fe67a1f1c8fb7dac619dfc759c62bbcf
  - name: docker.io/gridsuite/case-import-job
    digest: 1ba1e6c93fcd7cbfa7b122378a8c2bb26968d23b467915777b0598ab5278a81e
  - name: docker.io/gridsuite/cgmes-assembling-job
    digest: 38237f9ad50da707bfd20dd731dd05b73ff0b31b099ea1e8c6a224394ec91c76
  - name: docker.io/gridsuite/directory-server
    digest: 440b0813942a5855b392f1f19948e2448b2cfda8d7a348b8931f0843682c51fe

# Patch ingress host
patchesJson6902:
  - target:
      group: networking.k8s.io
      version: v1beta1
      kind: Ingress
      name: gridstudy-app-ingress
    path: patch_tls_ingress.yaml
  - target:
      group: networking.k8s.io
      version: v1beta1
      kind: Ingress
      name: gridstudy-app-ingress
    path: patch_ingress.yaml
  - target:
      group: networking.k8s.io
      version: v1beta1
      kind: Ingress
      name: gridmerge-app-ingress
    path: patch_tls_ingress.yaml
  - target:
      group: networking.k8s.io
      version: v1beta1
      kind: Ingress
      name: gridmerge-app-ingress
    path: patch_ingress.yaml
  - target:
      group: networking.k8s.io
      version: v1beta1
      kind: Ingress
      name: gridactions-app-ingress
    path: patch_tls_ingress.yaml
  - target:
      group: networking.k8s.io
      version: v1beta1
      kind: Ingress
      name: gridactions-app-ingress
    path: patch_ingress.yaml
  - target:
      group: networking.k8s.io
      version: v1beta1
      kind: Ingress
      name: apps-metadata-server-ingress
    path: patch_tls_ingress.yaml
  - target:
      group: networking.k8s.io
      version: v1beta1
      kind: Ingress
      name: apps-metadata-server-ingress
    path: patch_ingress.yaml
